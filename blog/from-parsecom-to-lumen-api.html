<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backend-Shmackend |  </title>
    <meta name="generator" content="VuePress 1.9.10">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-171809471-1"></script>
    <script crossorigin="anonymous" src="https://kit.fontawesome.com/d06759fb7a.js"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
      
          gtag('config', 'UA-171809471-1');
      </script>
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.15801c2f.css" as="style"><link rel="preload" href="/assets/js/app.31e0d844.js" as="script"><link rel="preload" href="/assets/js/2.4470ce03.js" as="script"><link rel="preload" href="/assets/js/1.185b50a8.js" as="script"><link rel="preload" href="/assets/js/40.57e4d385.js" as="script"><link rel="prefetch" href="/assets/js/10.b67bc8a6.js"><link rel="prefetch" href="/assets/js/11.0256ff5f.js"><link rel="prefetch" href="/assets/js/12.7bdc8d5d.js"><link rel="prefetch" href="/assets/js/13.786f62b7.js"><link rel="prefetch" href="/assets/js/14.91be0496.js"><link rel="prefetch" href="/assets/js/15.3b92efb8.js"><link rel="prefetch" href="/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/assets/js/17.368b07ea.js"><link rel="prefetch" href="/assets/js/18.8241d824.js"><link rel="prefetch" href="/assets/js/19.56a0d05b.js"><link rel="prefetch" href="/assets/js/20.87ddadca.js"><link rel="prefetch" href="/assets/js/21.e21ffad3.js"><link rel="prefetch" href="/assets/js/22.b2617b84.js"><link rel="prefetch" href="/assets/js/23.9cb272d5.js"><link rel="prefetch" href="/assets/js/24.72dd1d95.js"><link rel="prefetch" href="/assets/js/25.6b46d294.js"><link rel="prefetch" href="/assets/js/26.4976419b.js"><link rel="prefetch" href="/assets/js/27.3c3142d1.js"><link rel="prefetch" href="/assets/js/28.5c455e26.js"><link rel="prefetch" href="/assets/js/29.5cef27d3.js"><link rel="prefetch" href="/assets/js/3.8af8fcbf.js"><link rel="prefetch" href="/assets/js/30.b880b0d8.js"><link rel="prefetch" href="/assets/js/31.5da5aa26.js"><link rel="prefetch" href="/assets/js/32.1d2a5fe6.js"><link rel="prefetch" href="/assets/js/33.034d34fa.js"><link rel="prefetch" href="/assets/js/34.f94bc3bf.js"><link rel="prefetch" href="/assets/js/35.97643129.js"><link rel="prefetch" href="/assets/js/36.99419287.js"><link rel="prefetch" href="/assets/js/37.4c4d2b4c.js"><link rel="prefetch" href="/assets/js/38.3bca8a64.js"><link rel="prefetch" href="/assets/js/39.51deed91.js"><link rel="prefetch" href="/assets/js/4.a861951e.js"><link rel="prefetch" href="/assets/js/41.80ec462d.js"><link rel="prefetch" href="/assets/js/42.8ece1c0b.js"><link rel="prefetch" href="/assets/js/43.572b7729.js"><link rel="prefetch" href="/assets/js/44.dd5f0322.js"><link rel="prefetch" href="/assets/js/45.2a20bf20.js"><link rel="prefetch" href="/assets/js/46.6582cb0f.js"><link rel="prefetch" href="/assets/js/47.93f8f9f3.js"><link rel="prefetch" href="/assets/js/48.3ed7d992.js"><link rel="prefetch" href="/assets/js/49.970c14b7.js"><link rel="prefetch" href="/assets/js/5.842b4107.js"><link rel="prefetch" href="/assets/js/50.2d8c2403.js"><link rel="prefetch" href="/assets/js/6.9f813617.js"><link rel="prefetch" href="/assets/js/7.deca3814.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a43fb3db.js">
    <link rel="stylesheet" href="/assets/css/0.styles.15801c2f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> </span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>I was working with another developer on a new project, a single page application using a rest api. We were looking for something to help us start writing the backend quickly and decided to try Parse.com. It handled and hid many of the complexities for us like security, managing servers, tokens, resetting login passwords and provided a nice dashboard to view our data and manage the account.</p> <p>Initially things seemed fine. Creating api endpoints was easy, we wrote javascript functions on the server side (Nodejs) and then we could call those functions from the client:</p> <p>Server (cloudCode):</p> <div class="language- extra-class"><pre class="language-text"><code>Parse.Cloud.define(&quot;updateMember&quot;, function(request, response) { ... });
</code></pre></div><p>Client:</p> <div class="language- extra-class"><pre class="language-text"><code>Parse.Cloud.run('updateMember', params, { ... });
</code></pre></div><p>Easy. Almost too easy. The problems came as the requirements and complexity grew, our backend cloudCode was big file of js code. I started moving some common functions to modules but there were other issues with Parse. Debugging and reading the logfiles was terrible.</p> <p>Parse only kept a limited number of logged lines (yes lines, not log files, but lines, dozens of them...dozens!), which were only available in their dashboard, and some times the logs would simply stop updating. The final nail in the coffin was the announcement that Parse was shutting down.</p> <p>We had two options, run our own parse server or rewrite the backend. We chose the latter.</p> <p>We decided to go with Lumen, a lighter version of Laravel, with great documentation, PHP, and good community. It's worked well for us, though there are new concepts that I've needed to brush up on (which is great). Lumen sets things up so its easier to follow good practices like dependency injection and testing. It works with phpunit out of the box, and I recently setup acceptance testing with Codeception and Phantomjs.</p> <p>The fronted did not change much. I wrote a small client class to make the api requests to the new Lumen backend, so instead of having:</p> <div class="language- extra-class"><pre class="language-text"><code>Parse.Cloud.run('updateMember', params, { ... });  
</code></pre></div><p>we now use</p> <div class="language- extra-class"><pre class="language-text"><code>self.client.run('members/'+userid, 'put', params, { ... });
</code></pre></div><p>Our new api tries to use the proper https verbs for each requirement: get for fetching data, put for updating, post for creating data.
For the most part the same data is returned, and the calls use the same parameters, all that changed is the api calling methods.</p> <p>We used Knockoutjs for our SPA, so I had to create the new client object, pass the api url and security token:</p> <div class="language- extra-class"><pre class="language-text"><code>var viewModel = function() {
self.client = client('www.our-lumen-site.com'+'/api/', login_token);
}


And this is the client,mostly a wrapper of the jquery ajax request:

(function(root) {

root.client = function(host, token)
{
    var self = this;

    self.host = stripTrailingSlash(host);    
    self.token = token;


    var run = function(api, verb, data, callback ){

        data = data || {};
        callback = callback || {};        

        var token = self.token;

        api = api.trim();

        //remove first /, if it exists
        var re = /^\//;
        api.replace(re, &quot;&quot;);

        //remove last /, if it exists
        var re = /\/$/;
        api.replace(re, &quot;&quot;);

        verb = verb.trim();

        return $.ajax({
            url: self.host+'/'+api,
            type: verb || 'GET',
            //dataType: 'json',
            headers: {'Authorization': 'Bearer '+token},
            data: data,
            success: callback.success? callback.success : function(){log('success')},
            error: callback.error? callback.error :  function(){log('error')}
        });
    }

    var ret = {
        version: '0.1',
        run: run
    };

    return ret;
};

}(this));
</code></pre></div><p>The client class exposes the run function and the version only, all the other details like the host and url are hidden.</p> <p>All thing considered this turned out well, it allowed us to have greater control and learn and apply new tools. Our next future rewrite is using components for the frontend with React.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.31e0d844.js" defer></script><script src="/assets/js/2.4470ce03.js" defer></script><script src="/assets/js/1.185b50a8.js" defer></script><script src="/assets/js/40.57e4d385.js" defer></script>
  </body>
</html>
